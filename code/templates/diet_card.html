<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Diet Card - Fukuoka Evacuation System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f1f2f6; }
        .big-title { 
            font-size: 2.1em; 
            font-weight: 800; 
            margin-bottom: 0.2em; 
            letter-spacing: 1px; 
            background: linear-gradient(90deg, #e3f0ff 0%, #f8f9fa 100%); 
            border-radius: 12px; 
            padding: 18px 20px 12px 20px; 
            box-shadow: 0 2px 12px rgba(84,153,255,0.08); 
        }
        .diet-card { 
            background: #fff; 
            border-radius: 14px; 
            box-shadow: 0 2px 12px rgba(0,0,0,0.07); 
            padding: 32px 18px 18px 18px; 
            margin-bottom: 18px; 
            border: 1px solid #e9ecef; 
        }
        .diet-title { 
            font-size: 1.8em; 
            font-weight: 800; 
            margin-bottom: 0.2em; 
            letter-spacing: 1px; 
            background: linear-gradient(90deg, #ff6b6b 0%, #ffa726 100%); 
            border-radius: 12px; 
            padding: 18px 20px 12px 20px; 
            box-shadow: 0 2px 12px rgba(255,107,107,0.08); 
            text-align: left; 
            color: white;
        }
        .allergy-badge {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            margin: 4px;
            display: inline-block;
            font-weight: 600;
        }
        .preference-badge {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            margin: 4px;
            display: inline-block;
            font-weight: 600;
        }
        .emergency-info {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            border-left: 5px solid #ff6b6b;
        }
        .btn-primary, .btn-outline-danger { 
            font-weight: 600; 
            letter-spacing: 1px; 
            border-radius: 8px; 
        }
        .btn-primary:hover, .btn-outline-danger:hover { 
            filter: brightness(0.95); 
            box-shadow: 0 2px 8px rgba(84,153,255,0.10); 
        }
        .form-control {
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }
        .form-control:focus {
            border-color: #ff6b6b;
            box-shadow: 0 0 0 0.2rem rgba(255, 107, 107, 0.25);
        }
        .alert {
            border-radius: 12px;
            border: none;
        }
        .card {
            border-radius: 12px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <!-- Back button -->
            <div class="mt-3 mb-3">
                <a href="/" class="btn btn-outline-secondary">
                    ‚Üê Back to Home
                </a>
            </div>

            <!-- Main title -->
            <div class="big-title text-center mb-4">
                üçΩÔ∏è Diet Card - Personal Diet Information Management
            </div>

            {% if success_message %}
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                {{ success_message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endif %}

            {% if error_message %}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                {{ error_message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endif %}

            <!-- Diet card preview -->
            <div class="diet-card">
                <div class="diet-title">üìã Diet Card Preview</div>
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>üë§ Basic Information</h6>
                                <p><strong>Name:</strong>{{ diet_info.name or 'Not filled' }}</p>
                                <p><strong>Age:</strong>{{ diet_info.age or 'Not filled' }}</p>
                                <p><strong>Blood Type:</strong>{{ diet_info.blood_type or 'Not filled' }}</p>
                                <p><strong>Emergency Contact:</strong>{{ diet_info.emergency_contact or 'Not filled' }}</p>
                                <p><strong>Emergency Phone:</strong>{{ diet_info.emergency_phone or 'Not filled' }}</p>
                            </div>
                            <div class="col-md-6">
                                <h6>‚ö†Ô∏è Allergies ({{ allergies|length }} items)</h6>
                                {% if allergies %}
                                    {% for allergy in allergies %}
                                    <p><span class="allergy-badge">{{ allergy.food_name }} ({{ allergy.severity }})</span></p>
                                    {% endfor %}
                                {% else %}
                                    <p class="text-muted">No record</p>
                                {% endif %}
                                
                                <h6>üçé Diet Preferences ({{ preferences|length }} items)</h6>
                                {% if preferences %}
                                    {% for preference in preferences %}
                                    <p><span class="preference-badge">{{ preference.food_name }} ({{ preference.preference_type }})</span></p>
                                    {% endfor %}
                                {% else %}
                                    <p class="text-muted">No record</p>
                                {% endif %}
                            </div>
                        </div>
                        {% if diet_info.emergency_medication or diet_info.medical_notes %}
                        <hr>
                        <div class="row">
                            <div class="col-12">
                                <h6>üö® Emergency Medical Information</h6>
                                {% if diet_info.emergency_medication %}
                                <p><strong>Emergency Medication:</strong>{{ diet_info.emergency_medication }}</p>
                                {% endif %}
                                {% if diet_info.medical_notes %}
                                <p><strong>Medical Notes:</strong>{{ diet_info.medical_notes }}</p>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Basic information card -->
            <div class="diet-card">
                <div class="diet-title">üë§ Basic Information</div>
                <form method="post" action="/diet_card">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="name" class="form-label">Name</label>
                                <input type="text" class="form-control" id="name" name="name" 
                                       value="{{ diet_info.name or '' }}" placeholder="Please enter your name">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="age" class="form-label">Age</label>
                                <input type="number" class="form-control" id="age" name="age" 
                                       value="{{ diet_info.age or '' }}" placeholder="Please enter your age">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="blood_type" class="form-label">Blood Type</label>
                                <select class="form-control" id="blood_type" name="blood_type">
                                    <option value="">Please select blood type</option>
                                    <option value="A" {% if diet_info.blood_type == 'A' %}selected{% endif %}>Type A</option>
                                    <option value="B" {% if diet_info.blood_type == 'B' %}selected{% endif %}>Type B</option>
                                    <option value="O" {% if diet_info.blood_type == 'O' %}selected{% endif %}>Type O</option>
                                    <option value="AB" {% if diet_info.blood_type == 'AB' %}selected{% endif %}>Type AB</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="emergency_contact" class="form-label">Emergency Contact</label>
                                <input type="text" class="form-control" id="emergency_contact" name="emergency_contact" 
                                       value="{{ diet_info.emergency_contact or '' }}" placeholder="Please enter your emergency contact name">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="emergency_phone" class="form-label">Emergency Phone</label>
                        <input type="tel" class="form-control" id="emergency_phone" name="emergency_phone" 
                               value="{{ diet_info.emergency_phone or '' }}" placeholder="Please enter your emergency phone">
                    </div>
                    <button type="submit" class="btn btn-primary">üíæ Save Basic Information</button>
                </form>
            </div>

            <!-- Allergy food card -->
            <div class="diet-card">
                <div class="diet-title">‚ö†Ô∏è Allergies</div>
                
                <!-- Display existing allergies -->
                {% if allergies %}
                <div class="mb-3">
                    <h6>Currently recorded allergies:</h6>
                    {% for allergy in allergies %}
                    <span class="allergy-badge">
                        {{ allergy.food_name }}
                        <form method="post" action="/diet_card/delete_allergy" style="display: inline;">
                            <input type="hidden" name="allergy_id" value="{{ allergy.id }}">
                            <button type="submit" class="btn btn-sm btn-outline-light" 
                                    onclick="return confirm('Are you sure you want to delete {{ allergy.food_name }}?')" 
                                    style="margin-left: 8px; padding: 2px 6px; font-size: 0.8em;">
                                ‚úï
                            </button>
                        </form>
                    </span>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Add allergy food form -->
                <form method="post" action="/diet_card/add_allergy">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-3">
                                <label for="allergy_food_name" class="form-label">Allergy Name</label>
                                <input type="text" class="form-control" id="allergy_food_name" name="allergy_food_name" 
                                       placeholder="Please enter the name of the food you are allergic to" required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="allergy_severity" class="form-label">Severity</label>
                                <select class="form-control" id="allergy_severity" name="allergy_severity" required>
                                    <option value="">Please select severity</option>
                                    <option value="Light">Light</option>
                                    <option value="Medium">Medium</option>
                                    <option value="Severe">Severe</option>
                                    <option value="Fatal">Fatal</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="allergy_notes" class="form-label">Notes</label>
                        <textarea class="form-control" id="allergy_notes" name="allergy_notes" rows="3" 
                                  placeholder="Please describe the detailed information of the allergy..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-danger">‚ûï Add Allergy</button>
                </form>
            </div>

            <!-- Diet preferences card -->
            <div class="diet-card">
                <div class="diet-title">üçé Diet Preferences</div>
                
                <!-- Display existing preferences -->
                {% if preferences %}
                <div class="mb-3">
                    <h6>Currently recorded preferences:</h6>
                    {% for preference in preferences %}
                    <span class="preference-badge">
                        {{ preference.food_name }}
                        <form method="post" action="/diet_card/delete_preference" style="display: inline;">
                            <input type="hidden" name="preference_id" value="{{ preference.id }}">
                            <button type="submit" class="btn btn-sm btn-outline-light" 
                                    onclick="return confirm('Are you sure you want to delete {{ preference.food_name }}?')" 
                                    style="margin-left: 8px; padding: 2px 6px; font-size: 0.8em;">
                                ‚úï
                            </button>
                        </form>
                    </span>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Add diet preference form -->
                <form method="post" action="/diet_card/add_preference">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-3">
                                <label for="pref_food_name" class="form-label">Preference Food Name</label>
                                <input type="text" class="form-control" id="pref_food_name" name="pref_food_name" 
                                       placeholder="Please enter the name of the food you prefer or avoid" required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="pref_type" class="form-label">Preference Type</label>
                                <select class="form-control" id="pref_type" name="pref_type" required>
                                    <option value="">Please select type</option>
                                    <option value="Like">Like</option>
                                    <option value="Avoid">Avoid</option>
                                    <option value="Limit">Limit</option>
                                    <option value="Special Requirement">Special Requirement</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="pref_notes" class="form-label">Notes</label>
                        <textarea class="form-control" id="pref_notes" name="preference_notes" rows="3" 
                                  placeholder="Please describe the detailed information of the diet preference..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-success">‚ûï Add Diet Preference</button>
                </form>
            </div>

            <!-- Emergency information card -->
            <div class="diet-card">
                <div class="diet-title">üö® Emergency Information</div>
                <div class="emergency-info">
                    <h5>‚ö†Ô∏è Important Reminders in Emergency Situations</h5>
                    <ul>
                        <li>Please carry allergy medication (e.g. epinephrine injector)</li>
                        <li>When in a shelter or receiving rescue, please inform the staff about your allergy situation</li>
                        <li>Avoid eating food from unknown sources</li>
                        <li>Carry allergy identification bracelet or card</li>
                    </ul>
                </div>
                
                <form method="post" action="/diet_card">
                    <div class="mb-3">
                        <label for="emergency_medication" class="form-label">Emergency Medication</label>
                        <input type="text" class="form-control" id="emergency_medication" name="emergency_medication" 
                               value="{{ diet_info.emergency_medication or '' }}" 
                               placeholder="For example: epinephrine injector, antihistamine...">
                    </div>
                    <div class="mb-3">
                        <label for="medical_notes" class="form-label">Medical Notes</label>
                        <textarea class="form-control" id="medical_notes" name="medical_notes" rows="4" 
                                  placeholder="Other important medical information, chronic diseases, medication information, etc.">{{ diet_info.medical_notes or '' }}</textarea>
                    </div>
                    <button type="submit" class="btn btn-warning">üíæ Save Emergency Information</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 