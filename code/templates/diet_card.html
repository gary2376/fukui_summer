<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>飲食卡 - 福井避難系統</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f1f2f6; }
        .big-title { 
            font-size: 2.1em; 
            font-weight: 800; 
            margin-bottom: 0.2em; 
            letter-spacing: 1px; 
            background: linear-gradient(90deg, #e3f0ff 0%, #f8f9fa 100%); 
            border-radius: 12px; 
            padding: 18px 20px 12px 20px; 
            box-shadow: 0 2px 12px rgba(84,153,255,0.08); 
        }
        .diet-card { 
            background: #fff; 
            border-radius: 14px; 
            box-shadow: 0 2px 12px rgba(0,0,0,0.07); 
            padding: 32px 18px 18px 18px; 
            margin-bottom: 18px; 
            border: 1px solid #e9ecef; 
        }
        .diet-title { 
            font-size: 1.8em; 
            font-weight: 800; 
            margin-bottom: 0.2em; 
            letter-spacing: 1px; 
            background: linear-gradient(90deg, #ff6b6b 0%, #ffa726 100%); 
            border-radius: 12px; 
            padding: 18px 20px 12px 20px; 
            box-shadow: 0 2px 12px rgba(255,107,107,0.08); 
            text-align: left; 
            color: white;
        }
        .allergy-badge {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            margin: 4px;
            display: inline-block;
            font-weight: 600;
        }
        .preference-badge {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            margin: 4px;
            display: inline-block;
            font-weight: 600;
        }
        .emergency-info {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            border-left: 5px solid #ff6b6b;
        }
        .btn-primary, .btn-outline-danger { 
            font-weight: 600; 
            letter-spacing: 1px; 
            border-radius: 8px; 
        }
        .btn-primary:hover, .btn-outline-danger:hover { 
            filter: brightness(0.95); 
            box-shadow: 0 2px 8px rgba(84,153,255,0.10); 
        }
        .form-control {
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }
        .form-control:focus {
            border-color: #ff6b6b;
            box-shadow: 0 0 0 0.2rem rgba(255, 107, 107, 0.25);
        }
        .alert {
            border-radius: 12px;
            border: none;
        }
        .card {
            border-radius: 12px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <!-- 返回按鈕 -->
            <div class="mt-3 mb-3">
                <a href="/" class="btn btn-outline-secondary">
                    ← 返回主頁
                </a>
            </div>

            <!-- 主標題 -->
            <div class="big-title text-center mb-4">
                🍽️ 飲食卡 - 個人飲食資訊管理
            </div>

            {% if success_message %}
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                {{ success_message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endif %}

            {% if error_message %}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                {{ error_message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endif %}

            <!-- 基本資訊卡片 -->
            <div class="diet-card">
                <div class="diet-title">👤 基本資訊</div>
                <form method="post" action="/diet_card">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="name" class="form-label">姓名</label>
                                <input type="text" class="form-control" id="name" name="name" 
                                       value="{{ diet_info.name or '' }}" placeholder="請輸入您的姓名">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="age" class="form-label">年齡</label>
                                <input type="number" class="form-control" id="age" name="age" 
                                       value="{{ diet_info.age or '' }}" placeholder="請輸入年齡">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="blood_type" class="form-label">血型</label>
                                <select class="form-control" id="blood_type" name="blood_type">
                                    <option value="">請選擇血型</option>
                                    <option value="A" {% if diet_info.blood_type == 'A' %}selected{% endif %}>A型</option>
                                    <option value="B" {% if diet_info.blood_type == 'B' %}selected{% endif %}>B型</option>
                                    <option value="O" {% if diet_info.blood_type == 'O' %}selected{% endif %}>O型</option>
                                    <option value="AB" {% if diet_info.blood_type == 'AB' %}selected{% endif %}>AB型</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="emergency_contact" class="form-label">緊急聯絡人</label>
                                <input type="text" class="form-control" id="emergency_contact" name="emergency_contact" 
                                       value="{{ diet_info.emergency_contact or '' }}" placeholder="緊急聯絡人姓名">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="emergency_phone" class="form-label">緊急聯絡電話</label>
                        <input type="tel" class="form-control" id="emergency_phone" name="emergency_phone" 
                               value="{{ diet_info.emergency_phone or '' }}" placeholder="緊急聯絡電話">
                    </div>
                    <button type="submit" class="btn btn-primary">💾 儲存基本資訊</button>
                </form>
            </div>

            <!-- 過敏食物卡片 -->
            <div class="diet-card">
                <div class="diet-title">⚠️ 過敏食物</div>
                
                <!-- 顯示現有過敏食物 -->
                {% if allergies %}
                <div class="mb-3">
                    <h6>目前記錄的過敏食物：</h6>
                    {% for allergy in allergies %}
                    <span class="allergy-badge">
                        {{ allergy.food_name }}
                        <form method="post" action="/diet_card/delete_allergy" style="display: inline;">
                            <input type="hidden" name="allergy_id" value="{{ allergy.id }}">
                            <button type="submit" class="btn btn-sm btn-outline-light" 
                                    onclick="return confirm('確定要刪除 {{ allergy.food_name }} 嗎？')" 
                                    style="margin-left: 8px; padding: 2px 6px; font-size: 0.8em;">
                                ✕
                            </button>
                        </form>
                    </span>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- 新增過敏食物表單 -->
                <form method="post" action="/diet_card/add_allergy">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-3">
                                <label for="food_name" class="form-label">過敏食物名稱</label>
                                <input type="text" class="form-control" id="food_name" name="food_name" 
                                       placeholder="例如：花生、海鮮、牛奶..." required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="severity" class="form-label">嚴重程度</label>
                                <select class="form-control" id="severity" name="severity" required>
                                    <option value="輕微">輕微</option>
                                    <option value="中等">中等</option>
                                    <option value="嚴重">嚴重</option>
                                    <option value="致命">致命</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="allergy_notes" class="form-label">備註（症狀、處理方式等）</label>
                        <textarea class="form-control" id="allergy_notes" name="allergy_notes" rows="3" 
                                  placeholder="請描述過敏症狀、處理方式或其他重要資訊..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-danger">➕ 新增過敏食物</button>
                </form>
            </div>

            <!-- 飲食偏好卡片 -->
            <div class="diet-card">
                <div class="diet-title">🍎 飲食偏好</div>
                
                <!-- 顯示現有飲食偏好 -->
                {% if preferences %}
                <div class="mb-3">
                    <h6>目前記錄的飲食偏好：</h6>
                    {% for preference in preferences %}
                    <span class="preference-badge">
                        {{ preference.food_name }}
                        <form method="post" action="/diet_card/delete_preference" style="display: inline;">
                            <input type="hidden" name="preference_id" value="{{ preference.id }}">
                            <button type="submit" class="btn btn-sm btn-outline-light" 
                                    onclick="return confirm('確定要刪除 {{ preference.food_name }} 嗎？')" 
                                    style="margin-left: 8px; padding: 2px 6px; font-size: 0.8em;">
                                ✕
                            </button>
                        </form>
                    </span>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- 新增飲食偏好表單 -->
                <form method="post" action="/diet_card/add_preference">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-3">
                                <label for="pref_food_name" class="form-label">偏好食物名稱</label>
                                <input type="text" class="form-control" id="pref_food_name" name="food_name" 
                                       placeholder="例如：素食、無麩質、低糖..." required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="pref_type" class="form-label">偏好類型</label>
                                <select class="form-control" id="pref_type" name="preference_type" required>
                                    <option value="喜歡">喜歡</option>
                                    <option value="避免">避免</option>
                                    <option value="限制">限制</option>
                                    <option value="特殊需求">特殊需求</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="pref_notes" class="form-label">備註</label>
                        <textarea class="form-control" id="pref_notes" name="preference_notes" rows="3" 
                                  placeholder="請描述飲食偏好的詳細資訊..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-success">➕ 新增飲食偏好</button>
                </form>
            </div>

            <!-- 緊急資訊卡片 -->
            <div class="diet-card">
                <div class="diet-title">🚨 緊急資訊</div>
                <div class="emergency-info">
                    <h5>⚠️ 緊急情況下的重要提醒</h5>
                    <ul>
                        <li>請隨身攜帶過敏藥物（如腎上腺素注射器）</li>
                        <li>在避難所或接受救援時，務必告知工作人員您的過敏情況</li>
                        <li>避免食用來源不明的食物</li>
                        <li>隨身攜帶過敏識別手環或卡片</li>
                    </ul>
                </div>
                
                <form method="post" action="/diet_card">
                    <div class="mb-3">
                        <label for="emergency_medication" class="form-label">緊急用藥</label>
                        <input type="text" class="form-control" id="emergency_medication" name="emergency_medication" 
                               value="{{ diet_info.emergency_medication or '' }}" 
                               placeholder="例如：腎上腺素注射器、抗組織胺藥物...">
                    </div>
                    <div class="mb-3">
                        <label for="medical_notes" class="form-label">醫療備註</label>
                        <textarea class="form-control" id="medical_notes" name="medical_notes" rows="4" 
                                  placeholder="其他重要的醫療資訊、慢性疾病、用藥情況等...">{{ diet_info.medical_notes or '' }}</textarea>
                    </div>
                    <button type="submit" class="btn btn-warning">💾 儲存緊急資訊</button>
                </form>
            </div>

            <!-- 飲食卡預覽 -->
            <div class="diet-card">
                <div class="diet-title">📋 飲食卡預覽</div>
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>👤 基本資訊</h6>
                                <p><strong>姓名：</strong>{{ diet_info.name or '未填寫' }}</p>
                                <p><strong>年齡：</strong>{{ diet_info.age or '未填寫' }}</p>
                                <p><strong>血型：</strong>{{ diet_info.blood_type or '未填寫' }}</p>
                                <p><strong>緊急聯絡：</strong>{{ diet_info.emergency_contact or '未填寫' }}</p>
                                <p><strong>聯絡電話：</strong>{{ diet_info.emergency_phone or '未填寫' }}</p>
                            </div>
                            <div class="col-md-6">
                                <h6>⚠️ 過敏食物 ({{ allergies|length }}項)</h6>
                                {% if allergies %}
                                    {% for allergy in allergies %}
                                    <p><span class="allergy-badge">{{ allergy.food_name }} ({{ allergy.severity }})</span></p>
                                    {% endfor %}
                                {% else %}
                                    <p class="text-muted">無記錄</p>
                                {% endif %}
                                
                                <h6>🍎 飲食偏好 ({{ preferences|length }}項)</h6>
                                {% if preferences %}
                                    {% for preference in preferences %}
                                    <p><span class="preference-badge">{{ preference.food_name }} ({{ preference.preference_type }})</span></p>
                                    {% endfor %}
                                {% else %}
                                    <p class="text-muted">無記錄</p>
                                {% endif %}
                            </div>
                        </div>
                        {% if diet_info.emergency_medication or diet_info.medical_notes %}
                        <hr>
                        <div class="row">
                            <div class="col-12">
                                <h6>🚨 緊急醫療資訊</h6>
                                {% if diet_info.emergency_medication %}
                                <p><strong>緊急用藥：</strong>{{ diet_info.emergency_medication }}</p>
                                {% endif %}
                                {% if diet_info.medical_notes %}
                                <p><strong>醫療備註：</strong>{{ diet_info.medical_notes }}</p>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 