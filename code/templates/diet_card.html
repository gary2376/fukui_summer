<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>é£²é£Ÿå¡ - ç¦äº•é¿é›£ç³»çµ±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f1f2f6; }
        .big-title { 
            font-size: 2.1em; 
            font-weight: 800; 
            margin-bottom: 0.2em; 
            letter-spacing: 1px; 
            background: linear-gradient(90deg, #e3f0ff 0%, #f8f9fa 100%); 
            border-radius: 12px; 
            padding: 18px 20px 12px 20px; 
            box-shadow: 0 2px 12px rgba(84,153,255,0.08); 
        }
        .diet-card { 
            background: #fff; 
            border-radius: 14px; 
            box-shadow: 0 2px 12px rgba(0,0,0,0.07); 
            padding: 32px 18px 18px 18px; 
            margin-bottom: 18px; 
            border: 1px solid #e9ecef; 
        }
        .diet-title { 
            font-size: 1.8em; 
            font-weight: 800; 
            margin-bottom: 0.2em; 
            letter-spacing: 1px; 
            background: linear-gradient(90deg, #ff6b6b 0%, #ffa726 100%); 
            border-radius: 12px; 
            padding: 18px 20px 12px 20px; 
            box-shadow: 0 2px 12px rgba(255,107,107,0.08); 
            text-align: left; 
            color: white;
        }
        .allergy-badge {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            margin: 4px;
            display: inline-block;
            font-weight: 600;
        }
        .preference-badge {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            margin: 4px;
            display: inline-block;
            font-weight: 600;
        }
        .emergency-info {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            border-left: 5px solid #ff6b6b;
        }
        .btn-primary, .btn-outline-danger { 
            font-weight: 600; 
            letter-spacing: 1px; 
            border-radius: 8px; 
        }
        .btn-primary:hover, .btn-outline-danger:hover { 
            filter: brightness(0.95); 
            box-shadow: 0 2px 8px rgba(84,153,255,0.10); 
        }
        .form-control {
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }
        .form-control:focus {
            border-color: #ff6b6b;
            box-shadow: 0 0 0 0.2rem rgba(255, 107, 107, 0.25);
        }
        .alert {
            border-radius: 12px;
            border: none;
        }
        .card {
            border-radius: 12px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <!-- è¿”å›æŒ‰éˆ• -->
            <div class="mt-3 mb-3">
                <a href="/" class="btn btn-outline-secondary">
                    â† è¿”å›ä¸»é 
                </a>
            </div>

            <!-- ä¸»æ¨™é¡Œ -->
            <div class="big-title text-center mb-4">
                ğŸ½ï¸ é£²é£Ÿå¡ - å€‹äººé£²é£Ÿè³‡è¨Šç®¡ç†
            </div>

            {% if success_message %}
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                {{ success_message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endif %}

            {% if error_message %}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                {{ error_message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endif %}

            <!-- åŸºæœ¬è³‡è¨Šå¡ç‰‡ -->
            <div class="diet-card">
                <div class="diet-title">ğŸ‘¤ åŸºæœ¬è³‡è¨Š</div>
                <form method="post" action="/diet_card">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="name" class="form-label">å§“å</label>
                                <input type="text" class="form-control" id="name" name="name" 
                                       value="{{ diet_info.name or '' }}" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="age" class="form-label">å¹´é½¡</label>
                                <input type="number" class="form-control" id="age" name="age" 
                                       value="{{ diet_info.age or '' }}" placeholder="è«‹è¼¸å…¥å¹´é½¡">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="blood_type" class="form-label">è¡€å‹</label>
                                <select class="form-control" id="blood_type" name="blood_type">
                                    <option value="">è«‹é¸æ“‡è¡€å‹</option>
                                    <option value="A" {% if diet_info.blood_type == 'A' %}selected{% endif %}>Aå‹</option>
                                    <option value="B" {% if diet_info.blood_type == 'B' %}selected{% endif %}>Bå‹</option>
                                    <option value="O" {% if diet_info.blood_type == 'O' %}selected{% endif %}>Oå‹</option>
                                    <option value="AB" {% if diet_info.blood_type == 'AB' %}selected{% endif %}>ABå‹</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="emergency_contact" class="form-label">ç·Šæ€¥è¯çµ¡äºº</label>
                                <input type="text" class="form-control" id="emergency_contact" name="emergency_contact" 
                                       value="{{ diet_info.emergency_contact or '' }}" placeholder="ç·Šæ€¥è¯çµ¡äººå§“å">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="emergency_phone" class="form-label">ç·Šæ€¥è¯çµ¡é›»è©±</label>
                        <input type="tel" class="form-control" id="emergency_phone" name="emergency_phone" 
                               value="{{ diet_info.emergency_phone or '' }}" placeholder="ç·Šæ€¥è¯çµ¡é›»è©±">
                    </div>
                    <button type="submit" class="btn btn-primary">ğŸ’¾ å„²å­˜åŸºæœ¬è³‡è¨Š</button>
                </form>
            </div>

            <!-- éæ•é£Ÿç‰©å¡ç‰‡ -->
            <div class="diet-card">
                <div class="diet-title">âš ï¸ éæ•é£Ÿç‰©</div>
                
                <!-- é¡¯ç¤ºç¾æœ‰éæ•é£Ÿç‰© -->
                {% if allergies %}
                <div class="mb-3">
                    <h6>ç›®å‰è¨˜éŒ„çš„éæ•é£Ÿç‰©ï¼š</h6>
                    {% for allergy in allergies %}
                    <span class="allergy-badge">
                        {{ allergy.food_name }}
                        <form method="post" action="/diet_card/delete_allergy" style="display: inline;">
                            <input type="hidden" name="allergy_id" value="{{ allergy.id }}">
                            <button type="submit" class="btn btn-sm btn-outline-light" 
                                    onclick="return confirm('ç¢ºå®šè¦åˆªé™¤ {{ allergy.food_name }} å—ï¼Ÿ')" 
                                    style="margin-left: 8px; padding: 2px 6px; font-size: 0.8em;">
                                âœ•
                            </button>
                        </form>
                    </span>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- æ–°å¢éæ•é£Ÿç‰©è¡¨å–® -->
                <form method="post" action="/diet_card/add_allergy">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-3">
                                <label for="food_name" class="form-label">éæ•é£Ÿç‰©åç¨±</label>
                                <input type="text" class="form-control" id="food_name" name="food_name" 
                                       placeholder="ä¾‹å¦‚ï¼šèŠ±ç”Ÿã€æµ·é®®ã€ç‰›å¥¶..." required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="severity" class="form-label">åš´é‡ç¨‹åº¦</label>
                                <select class="form-control" id="severity" name="severity" required>
                                    <option value="è¼•å¾®">è¼•å¾®</option>
                                    <option value="ä¸­ç­‰">ä¸­ç­‰</option>
                                    <option value="åš´é‡">åš´é‡</option>
                                    <option value="è‡´å‘½">è‡´å‘½</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="allergy_notes" class="form-label">å‚™è¨»ï¼ˆç—‡ç‹€ã€è™•ç†æ–¹å¼ç­‰ï¼‰</label>
                        <textarea class="form-control" id="allergy_notes" name="allergy_notes" rows="3" 
                                  placeholder="è«‹æè¿°éæ•ç—‡ç‹€ã€è™•ç†æ–¹å¼æˆ–å…¶ä»–é‡è¦è³‡è¨Š..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-danger">â• æ–°å¢éæ•é£Ÿç‰©</button>
                </form>
            </div>

            <!-- é£²é£Ÿåå¥½å¡ç‰‡ -->
            <div class="diet-card">
                <div class="diet-title">ğŸ é£²é£Ÿåå¥½</div>
                
                <!-- é¡¯ç¤ºç¾æœ‰é£²é£Ÿåå¥½ -->
                {% if preferences %}
                <div class="mb-3">
                    <h6>ç›®å‰è¨˜éŒ„çš„é£²é£Ÿåå¥½ï¼š</h6>
                    {% for preference in preferences %}
                    <span class="preference-badge">
                        {{ preference.food_name }}
                        <form method="post" action="/diet_card/delete_preference" style="display: inline;">
                            <input type="hidden" name="preference_id" value="{{ preference.id }}">
                            <button type="submit" class="btn btn-sm btn-outline-light" 
                                    onclick="return confirm('ç¢ºå®šè¦åˆªé™¤ {{ preference.food_name }} å—ï¼Ÿ')" 
                                    style="margin-left: 8px; padding: 2px 6px; font-size: 0.8em;">
                                âœ•
                            </button>
                        </form>
                    </span>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- æ–°å¢é£²é£Ÿåå¥½è¡¨å–® -->
                <form method="post" action="/diet_card/add_preference">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-3">
                                <label for="pref_food_name" class="form-label">åå¥½é£Ÿç‰©åç¨±</label>
                                <input type="text" class="form-control" id="pref_food_name" name="food_name" 
                                       placeholder="ä¾‹å¦‚ï¼šç´ é£Ÿã€ç„¡éº©è³ªã€ä½ç³–..." required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="pref_type" class="form-label">åå¥½é¡å‹</label>
                                <select class="form-control" id="pref_type" name="preference_type" required>
                                    <option value="å–œæ­¡">å–œæ­¡</option>
                                    <option value="é¿å…">é¿å…</option>
                                    <option value="é™åˆ¶">é™åˆ¶</option>
                                    <option value="ç‰¹æ®Šéœ€æ±‚">ç‰¹æ®Šéœ€æ±‚</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="pref_notes" class="form-label">å‚™è¨»</label>
                        <textarea class="form-control" id="pref_notes" name="preference_notes" rows="3" 
                                  placeholder="è«‹æè¿°é£²é£Ÿåå¥½çš„è©³ç´°è³‡è¨Š..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-success">â• æ–°å¢é£²é£Ÿåå¥½</button>
                </form>
            </div>

            <!-- ç·Šæ€¥è³‡è¨Šå¡ç‰‡ -->
            <div class="diet-card">
                <div class="diet-title">ğŸš¨ ç·Šæ€¥è³‡è¨Š</div>
                <div class="emergency-info">
                    <h5>âš ï¸ ç·Šæ€¥æƒ…æ³ä¸‹çš„é‡è¦æé†’</h5>
                    <ul>
                        <li>è«‹éš¨èº«æ”œå¸¶éæ•è—¥ç‰©ï¼ˆå¦‚è…ä¸Šè…ºç´ æ³¨å°„å™¨ï¼‰</li>
                        <li>åœ¨é¿é›£æ‰€æˆ–æ¥å—æ•‘æ´æ™‚ï¼Œå‹™å¿…å‘ŠçŸ¥å·¥ä½œäººå“¡æ‚¨çš„éæ•æƒ…æ³</li>
                        <li>é¿å…é£Ÿç”¨ä¾†æºä¸æ˜çš„é£Ÿç‰©</li>
                        <li>éš¨èº«æ”œå¸¶éæ•è­˜åˆ¥æ‰‹ç’°æˆ–å¡ç‰‡</li>
                    </ul>
                </div>
                
                <form method="post" action="/diet_card">
                    <div class="mb-3">
                        <label for="emergency_medication" class="form-label">ç·Šæ€¥ç”¨è—¥</label>
                        <input type="text" class="form-control" id="emergency_medication" name="emergency_medication" 
                               value="{{ diet_info.emergency_medication or '' }}" 
                               placeholder="ä¾‹å¦‚ï¼šè…ä¸Šè…ºç´ æ³¨å°„å™¨ã€æŠ—çµ„ç¹”èƒºè—¥ç‰©...">
                    </div>
                    <div class="mb-3">
                        <label for="medical_notes" class="form-label">é†«ç™‚å‚™è¨»</label>
                        <textarea class="form-control" id="medical_notes" name="medical_notes" rows="4" 
                                  placeholder="å…¶ä»–é‡è¦çš„é†«ç™‚è³‡è¨Šã€æ…¢æ€§ç–¾ç—…ã€ç”¨è—¥æƒ…æ³ç­‰...">{{ diet_info.medical_notes or '' }}</textarea>
                    </div>
                    <button type="submit" class="btn btn-warning">ğŸ’¾ å„²å­˜ç·Šæ€¥è³‡è¨Š</button>
                </form>
            </div>

            <!-- é£²é£Ÿå¡é è¦½ -->
            <div class="diet-card">
                <div class="diet-title">ğŸ“‹ é£²é£Ÿå¡é è¦½</div>
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>ğŸ‘¤ åŸºæœ¬è³‡è¨Š</h6>
                                <p><strong>å§“åï¼š</strong>{{ diet_info.name or 'æœªå¡«å¯«' }}</p>
                                <p><strong>å¹´é½¡ï¼š</strong>{{ diet_info.age or 'æœªå¡«å¯«' }}</p>
                                <p><strong>è¡€å‹ï¼š</strong>{{ diet_info.blood_type or 'æœªå¡«å¯«' }}</p>
                                <p><strong>ç·Šæ€¥è¯çµ¡ï¼š</strong>{{ diet_info.emergency_contact or 'æœªå¡«å¯«' }}</p>
                                <p><strong>è¯çµ¡é›»è©±ï¼š</strong>{{ diet_info.emergency_phone or 'æœªå¡«å¯«' }}</p>
                            </div>
                            <div class="col-md-6">
                                <h6>âš ï¸ éæ•é£Ÿç‰© ({{ allergies|length }}é …)</h6>
                                {% if allergies %}
                                    {% for allergy in allergies %}
                                    <p><span class="allergy-badge">{{ allergy.food_name }} ({{ allergy.severity }})</span></p>
                                    {% endfor %}
                                {% else %}
                                    <p class="text-muted">ç„¡è¨˜éŒ„</p>
                                {% endif %}
                                
                                <h6>ğŸ é£²é£Ÿåå¥½ ({{ preferences|length }}é …)</h6>
                                {% if preferences %}
                                    {% for preference in preferences %}
                                    <p><span class="preference-badge">{{ preference.food_name }} ({{ preference.preference_type }})</span></p>
                                    {% endfor %}
                                {% else %}
                                    <p class="text-muted">ç„¡è¨˜éŒ„</p>
                                {% endif %}
                            </div>
                        </div>
                        {% if diet_info.emergency_medication or diet_info.medical_notes %}
                        <hr>
                        <div class="row">
                            <div class="col-12">
                                <h6>ğŸš¨ ç·Šæ€¥é†«ç™‚è³‡è¨Š</h6>
                                {% if diet_info.emergency_medication %}
                                <p><strong>ç·Šæ€¥ç”¨è—¥ï¼š</strong>{{ diet_info.emergency_medication }}</p>
                                {% endif %}
                                {% if diet_info.medical_notes %}
                                <p><strong>é†«ç™‚å‚™è¨»ï¼š</strong>{{ diet_info.medical_notes }}</p>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 